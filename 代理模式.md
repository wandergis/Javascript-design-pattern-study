# 代理模式

> Proxy:由于一个对象不能直接引用另一个对象，所以需要通过代理对象在这两个对象之间起到中介作用。

## 无法获取图片上传模块数据
因跨域不能获取图片。

## 一切只因跨域
JavaScript出于对安全访问的角度，不允许跨域调用其他页面。同源策略限制。
需要找一个代理对象来实现相互之间的通信。

## 站长统计
img标签的src属性可以向其他域下的服务器发起请求，不过这类请求是get方式，并且是单向的，不会有响应数据。

```
//统计代理
var Count = (function() {
    //缓存图片，参考备忘录模式
    var _img = new Image();
    //返回统计函数
    return function(param) {
        //统计请求字符串
        var str = 'http://www.count.com/a.gif?';
        //拼接请求字符串
        for (var i in param) {
            str += i + '=' + param[i];
        }
        //发送统计请求
        _img.src = str;
    }
})();
//测试用例
Count({ num: 10 });
```

## JSONP

还可以通过script标签，发起get请求，根据请求对应生成一份内容。

## 代理模板

这需要其他域要有一定的可靠性，否则会攻击你的网站，有时我们会动态生成jsonp中的script标签。
另外的解决方案：
不同域之间相互调用对方的页面是有限制的，自己域中的两个页面相互之间调用确实可以的，即代理页面B访问被代理的页面A中的对象。这样我们只要在被访问的域中，请求返回的Header重定向到代理页面，并在代理页面中处理被代理的页面A就可以了。